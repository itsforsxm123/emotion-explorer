# Emotion Explorer

**Emotion Explorer** is a desktop application built with Go and the Fyne GUI toolkit. Its primary purpose is to provide a tool for **visually exploring a hierarchical dataset of human emotions**, allowing users to understand the relationships and nuances between different feelings (based on models like Plutchik's wheel or similar structures).

The **long-term vision** is to evolve this explorer into a **personal emotion tracking and journaling tool**, helping users become more aware of their emotional patterns over time.

## Current Status

The application provides a functional explorer for the emotion hierarchy and includes initial journaling capabilities:

*   **Data Loading:** Successfully loads and parses emotion data from an embedded `emotions.json` file at startup.
*   **Card-Based UI:** Displays emotions at each level as interactive Cards, each showing:
    *   A color swatch representing the emotion's defined color.
    *   The emotion's name.
*   **Hierarchical Navigation (Browsing Mode):** Allows users to navigate up to three levels deep (Primary -> Secondary -> Tertiary emotions) by clicking on the emotion cards.
*   **System Tray Integration:**
    *   Runs with an icon in the system tray/menu bar.
    *   Provides menu options: "Show Window", "Log Current Feeling...", "Quit".
    *   Closing the main window hides it, allowing the app to run in the background (if tray is supported).
*   **Mode-Based Operation:** Application operates in distinct `ModeBrowsing` and `ModeLogging` states.
*   **Stack-Based Navigation:**
    *   Uses separate navigation stacks (`navigationStack`, `loggingNavigationStack`) to manage views for browsing and logging modes independently.
    *   A single, global **Back Button** is present. Its action correctly pops the relevant stack based on the current mode (`ModeBrowsing` or `ModeLogging`).
    *   The Back Button is automatically enabled/disabled based on the active stack's depth.
*   **Emotion Logging Flow:**
    *   Initiated via the "Log Current Feeling..." tray menu item, switching to `ModeLogging`.
    *   Allows navigation through the emotion hierarchy (Primary -> Secondary -> Tertiary) using the `loggingNavigationStack`.
    *   The **Back Button** correctly navigates up one level within the logging hierarchy (e.g., from Tertiary selection back to Secondary selection).
    *   Requires selecting a *leaf* node emotion to complete the log.
*   **Journal Persistence:**
    *   Successfully saves selected leaf emotions as `LogEntry` structs (Timestamp, EmotionID, EmotionName) to a `journal.json` file in the application's working directory.
    *   Handles creating the file if it doesn't exist and appending new entries.
    *   Uses dialogs for confirmation/error feedback on saving.
    *   Returns to `ModeBrowsing` after a successful or failed save attempt.
*   **Refactored UI Code:**
    *   UI views for displaying emotion lists are generated by a single, generic function (`internal/ui/CreateEmotionListView`).
    *   This view component is now simpler, relying on the global back button and navigation stacks for navigation control.
*   **Custom Widget:** A custom `TappableCard` widget (`internal/ui/widgets.go`) is used to make the visual cards clickable.
*   **Core Logic:** Helper functions for identifying primary emotions and finding children of any given emotion are implemented and unit-tested (`internal/core`).
*   **Clean Code Refactor:** Main application logic (`main.go`) refactored for better separation of concerns, readability, and centralized UI updates.

*(Add screenshots/GIF here showing the Card UI, Tray Menu, and Logging Flow with correct back navigation)*

## Technology Stack

*   **Language:** Go (Golang)
*   **GUI Toolkit:** Fyne (v2)
*   **Data Handling:** Go `embed` package, standard `encoding/json`.

## Project Structure Overview

*(This structure remains accurate)*
emotion-explorer/
├── cmd/
│   └── emotion-explorer/
│       └── main.go         # App entry point, window setup, mode/navigation logic handlers.
├── internal/
│   ├── core/
│   │   ├── hierarchy.go    # GetPrimaryEmotions, GetChildrenOf
│   │   └── hierarchy_test.go # Unit tests for hierarchy functions
│   ├── data/
│   │   ├── emotions.json   # Embedded emotion data
│   │   ├── loader.go       # LoadEmotions function using embed
│   │   ├── loader_test.go  # Unit test for loader
│   │   └── models.go       # Go structs for JSON data (EmotionData, Emotion)
│   ├── journal/             # Journaling functionality
│   │   ├── models.go     # LogEntry struct definition
│   │   ├── storage.go    # SaveLogEntry, loadJournalEntries functions
│   │   └── storage_test.go # Placeholder tests for journal storage
│   └── ui/
│       ├── views.go        # Generic CreateEmotionListView function, parseHexColor
│       └── widgets.go      # Custom widgets (e.g., TappableCard)
├── go.mod
├── go.sum
├── journal.json         # Example journal file (created at runtime)
└── README.md

## Getting Started

**Prerequisites:**

1.  **Go:** Version 1.18 or later recommended.
2.  **C Compiler:** Fyne requires a C compiler for CGO. Follow the Fyne documentation instructions for your OS: [https://developer.fyne.io/started/](https://developer.fyne.io/started/)
    *   **Windows:** Requires `gcc` via MinGW (e.g., installed via MSYS2). Ensure GCC is correctly added to your system PATH.
    *   **macOS:** Requires Xcode Command Line Tools.
    *   **Linux:** Requires `gcc` and relevant development packages (e.g., `build-essential`, `libgl1-mesa-dev`, `xorg-dev` on Debian/Ubuntu).

**Running the Application:**

1.  **Clone the repository:**
    ```bash
    git clone https://github.com/itsforsxm123/emotion-explorer.git
    cd emotion-explorer
    ```
2.  **Ensure Dependencies are Present:**
    ```bash
    go mod tidy
    ```
3.  **Run from source:**
    ```bash
    go run ./cmd/emotion-explorer/
    ```
    *(The first run might take a moment to download dependencies.)*
    *(A `journal.json` file will be created in the `emotion-explorer` directory after you log an emotion.)*

## Current Development Stage & Next Steps

The application has successfully transitioned from a simple explorer to having foundational journaling capabilities integrated with the system tray. The core loop of selecting and saving an emotion log entry is functional, and navigation within both browsing and logging modes behaves correctly using dedicated stacks.

**Completed:**

*   **Refine Logging Back Navigation:** Implemented separate navigation stacks for browsing and logging modes. A global back button now correctly handles popping the appropriate stack based on the current mode, ensuring intuitive navigation within the logging flow.

**Next Steps / Current Focus:**

The immediate focus remains on **enhancing the journaling features**:

1.  **Implement Notes Input:**
    *   **Goal:** Allow users to add free-text notes to their emotion log entries.
    *   **Implementation:** After a leaf emotion is selected in logging mode (`handleLogEmotionSelection`), instead of saving immediately, show a `dialog.NewForm`. This form should display the selected emotion and provide a `widget.NewMultiLineEntry` for notes. Add "Save" and "Cancel" buttons. Only call `journal.SaveLogEntry` (including the notes) if "Save" is clicked. Update `LogEntry` struct and `SaveLogEntry` if needed (Notes field already exists).
2.  **Basic Journal Viewing:**
    *   **Goal:** Provide a way to see the logged entries.
    *   **Implementation:**
        *   Add a new "View Journal" item to the system tray menu.
        *   When clicked, call a new function (e.g., `showJournalView`).
        *   This function will load entries using `journal.GetJournalEntries()` (or `loadJournalEntries`).
        *   Display the loaded entries in a new window (`myApp.NewWindow("Journal")`) using a `widget.List`. Format each entry nicely (e.g., "YYYY-MM-DD HH:MM - Emotion Name - Notes").
3.  **Refactor Storage Location:**
    *   **Goal:** Store `journal.json` in a standard user-specific location.
    *   **Implementation:** Modify `internal/journal/storage.go` to use `os.UserConfigDir()` to determine the path (e.g., within an `EmotionExplorer` subdirectory). Ensure the directory is created if needed. Update file loading/saving logic.
4.  **Improve Logging UI/UX:**
    *   Consider subtle visual cues to make it clearer when the user is in "Logging Mode" vs. "Browsing Mode" (e.g., slightly different background color, persistent header text in the view).
5.  **Data Completion:** Add missing color codes to `emotions.json` (e.g., for "Hopeful", "Inspired", "Hostile") to fix warnings and improve visual consistency.

## Future Plans / Longer-Term Vision

Once the core journaling UX is refined:

*   **Journal Editing/Deletion:** Allow users to modify or remove past entries.
*   **Calendar View:** Implement a visual calendar to browse entries by date.
*   **Data Visualization:** Add simple charts/graphs to show emotion frequency or trends over time.
*   **Intensity Tracking:** Add an optional intensity slider/selector to the logging process.
*   **Search/Filtering:** Implement search and filtering capabilities for the journal view.
*   **Settings:** Add a settings dialog (e.g., to configure storage location, maybe theme).
*   **Custom Icons/Theming:** Replace placeholder icons and potentially add theme support.

## Contributing

Contributions are welcome! Please feel free to open an issue to discuss potential changes or submit a pull request.

## License

This project is licensed under the MIT License - see the details below.

Copyright (c) 2025 itsforsxm123

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.